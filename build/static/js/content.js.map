{"version":3,"file":"static/js/content.js","mappings":"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","sources":["content.js"],"sourcesContent":["const query = {\n  number: \".present-single-question__head fieldset legend\",\n  question: \".present-single-question__head fieldset div\",\n  group: \".present-single-question__body .mdc-form-field\",\n  image: \".present-single-question__head fieldset img\",\n  nav: \".assignment > div > div:nth-child(3)\",\n  avatar: \".user-avatar\",\n};\nlet [finalAnswer, groupAnswer, groupImgs, test] = [[], [], [], []];\nconst [question, select, cachedImgs] = [{}, new Set(), []];\nconst url = \"https://api.luusytruong.id.vn/lms/temp.php\";\nconst label = [\"A. \", \"B. \", \"C. \", \"D. \"];\n\nconsole.clear();\n\nfunction normal(str) {\n  return str.normalize(\"NFKC\").replace(/\\s+/g, \" \").trim();\n}\n\nasync function handleUpload(blobUrl) {\n  const fileName = blobUrl.split(\"/\").pop();\n  const existFile = cachedImgs.find((img) => img.name === fileName);\n  if (existFile) return existFile.src;\n\n  try {\n    const responseBlob = await fetch(blobUrl);\n    if (!responseBlob.ok) throw new Error(\"Mất kết nối\");\n    const blob = await responseBlob.blob();\n    const formData = new FormData();\n    formData.append(\"blob\", blob);\n\n    const response = await fetch(url, {\n      method: \"POST\",\n      body: formData,\n    });\n    if (!response.ok) throw new Error(\"Mất kết nối\");\n    const result = await response.json();\n    if (result.src) {\n      cachedImgs.push({ name: fileName, src: result.src });\n      console.log(\"thành công\");\n      return result.src;\n    }\n    throw new Error(`Lỗi: ${result}`);\n  } catch (e) {\n    console.error(e);\n    return { error: true };\n  }\n}\n\nfunction handleChange(e) {\n  const elem = e.target;\n  const i = parseInt(elem.dataset.index, 10);\n  if (elem?.type === \"radio\") {\n    select.clear();\n    select.add(i);\n  } else {\n    elem?.checked ? select.add(i) : select.delete(i);\n  }\n  handleBuild();\n}\n\nasync function handleSelect(auto) {\n  if (!auto) return;\n  const data = await handleGet(\"auto\");\n  const autoData = new Set(data);\n  const groups = document.querySelectorAll(query.group);\n  const questionElem = document.querySelector(query.question);\n  const numberElem = document.querySelector(query.number);\n  const imgElem = document.querySelector(query.image);\n\n  select.clear();\n  [finalAnswer, groupAnswer, groupImgs] = [[], [], []];\n  question.img_src = \"\";\n\n  if (questionElem) {\n    question.text = normal(questionElem.innerText);\n  }\n  if (numberElem) {\n    question.no = parseInt(numberElem.innerText.replace(/\\D/g, \"\"));\n  }\n  if (imgElem) {\n    await new Promise((resolve) => {\n      const interval = setInterval(async () => {\n        if (!imgElem.src.includes(\"blob\")) return;\n        clearInterval(interval);\n        question.img_src = await handleUpload(imgElem.src);\n        resolve();\n      }, 100);\n    });\n  }\n\n  for (let i = 0; i < groups.length; i++) {\n    const input = groups[i].querySelector(\"input\");\n    const label = groups[i].querySelector(\"label\");\n    const image = groups[i].querySelector(\"img\");\n\n    if (input) {\n      input.dataset.index = i;\n      input.removeEventListener(\"click\", handleChange);\n      input.addEventListener(\"click\", handleChange);\n    }\n    if (label && label.innerText !== \"\") {\n      const ans = normal(label.innerText);\n      const key = normal(question.text + \" \" + ans).toLowerCase();\n      groupAnswer[i] = ans;\n      if (auto && autoData.has(key)) {\n        label.classList.add(\"selected-hehe\");\n        const interval = setInterval(() => {\n          if (groupAnswer.length < 4) return;\n          clearInterval(interval);\n          label.click();\n        }, 10);\n      }\n    } else if (image) {\n      const src = await handleUpload(image.src);\n      groupImgs[i] = { type: \"img\", src: src };\n    }\n  }\n\n  console.log(\"%ccall select\", \"color: #00AA00; font-size: 20px\");\n}\n\nasync function handleBuild() {\n  if (groupAnswer.length < 4) return;\n  for (let i = 0; i < groupAnswer.length; i++) {\n    const value = groupAnswer[i] ?? groupImgs[i];\n    if (value) {\n      finalAnswer[i] = (select.has(i) ? `*${label[i]}` : label[i]) + value;\n    }\n  }\n  test[question.no - 1] = {\n    ...question,\n    options: finalAnswer,\n    select: Array.from(select),\n  };\n  await handleSet(\"test\", test);\n}\n\nasync function handleSet(key, data) {\n  try {\n    if (typeof chrome !== \"undefined\" && chrome.storage) {\n      chrome.storage.local.set({ [key]: data }, () => {\n        console.log(`Lưu thành công với key: ${key}`);\n      });\n    } else {\n      console.error(\"Lỗi: không phải môi trường extension\");\n    }\n  } catch (e) {\n    console.error(\"handle save: \" + e.message);\n  }\n}\n\nasync function handleGet(key) {\n  if (typeof chrome === \"undefined\" && !chrome.storage) {\n    console.error(\"Lỗi: không phải môi trường extension\");\n    return;\n  }\n  return new Promise((resolve, reject) => {\n    try {\n      chrome.storage.local.get([key], (result) => {\n        if (result[key]) {\n          console.log(`Lấy thành công với key: ${key}`);\n          resolve(result[key]);\n        } else {\n          console.log(`Lấy thất bại với key: ${key}`);\n          resolve([]);\n        }\n      });\n    } catch (e) {\n      console.error(\"handle Get: \" + e.message);\n      reject(e);\n    }\n  });\n}\n\nasync function handleToggle() {\n  const setting = await handleGet(\"settings\");\n  const versionLabel = document.querySelector(\".app-version\");\n\n  if (!setting?.toggle) return;\n  if (versionLabel) {\n    versionLabel.addEventListener(\"click\", () => {\n      handleSelect(setting?.auto);\n    });\n  }\n  handleAddEvent(setting?.auto);\n}\n\nfunction handleAddEvent(auto) {\n  const handleClick = () => {\n    if (handleClick.debouncing) return;\n    handleClick.debouncing = true;\n    setTimeout(() => {\n      handleSelect(auto);\n      handleClick.debouncing = false;\n    }, 100);\n  };\n\n  setInterval(() => {\n    const nav = document.querySelector(query.nav);\n    if (!nav) return;\n    console.log(\"đã tìm thấy\");\n    nav.removeEventListener(\"click\", handleClick);\n    nav.addEventListener(\"click\", handleClick);\n  }, 1000);\n}\n\nif (window.location.href.includes(\"lms.ictu.edu.vn\")) {\n  handleToggle();\n  window.addEventListener(\n    \"contextmenu\",\n    function (e) {\n      e.stopPropagation();\n    },\n    true\n  );\n}\n"],"names":["query","finalAnswer","groupAnswer","groupImgs","test","question","select","cachedImgs","Set","label","normal","str","normalize","replace","trim","async","handleUpload","blobUrl","fileName","split","pop","existFile","find","img","name","src","responseBlob","fetch","ok","Error","blob","formData","FormData","append","response","method","body","result","json","push","console","log","e","error","handleChange","elem","target","i","parseInt","dataset","index","type","clear","add","checked","delete","length","_groupAnswer$i","value","has","no","options","Array","from","key","data","chrome","storage","local","set","message","handleSet","handleBuild","handleSelect","auto","handleGet","autoData","groups","document","querySelectorAll","questionElem","querySelector","numberElem","imgElem","img_src","text","innerText","Promise","resolve","interval","setInterval","includes","clearInterval","input","image","removeEventListener","addEventListener","ans","toLowerCase","classList","click","reject","get","window","location","href","setting","versionLabel","toggle","handleClick","debouncing","setTimeout","nav","handleAddEvent","handleToggle","stopPropagation"],"sourceRoot":""}