{"version":3,"file":"static/js/content.js","mappings":"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","sources":["content/content.js"],"sourcesContent":["const query = {\n  number: \".present-single-question__head fieldset legend\",\n  question: \".present-single-question__head fieldset div\",\n  group: \".present-single-question__body .mdc-form-field\",\n  image: \".present-single-question__head fieldset img\",\n  btns: \"button\",\n  label: \"Câu hỏi tiếp theo\",\n  avatar: \".user-avatar\",\n};\nconst style = \"font-size: 20px; color:#39C134; font-family: Inter\";\nlet [finalAnswer, groupAnswer, groupImgs, test] = [[], [], [], []];\nconst [question, select, cachedImgs] = [{}, new Set(), []];\nconst url = \"https://luusytruong.id.vn/api/lms/temp.php\";\nconst label = [\"A. \", \"B. \", \"C. \", \"D. \"];\n\nfunction normal(str) {\n  return str.normalize(\"NFKC\").replace(/\\s+/g, \" \").trim();\n}\n\nfunction standard(str) {\n  return str.normalize(\"NFKC\").trim();\n}\n\nasync function handleUpload(blobUrl) {\n  const fileName = blobUrl.split(\"/\").pop();\n  const existFile = cachedImgs.find((img) => img.name === fileName);\n  if (existFile) return existFile.src;\n\n  try {\n    const responseBlob = await fetch(blobUrl);\n    if (!responseBlob.ok) throw new Error(\"Mất kết nối\");\n    const blob = await responseBlob.blob();\n    const formData = new FormData();\n    formData.append(\"blob\", blob);\n\n    const response = await fetch(url, {\n      method: \"POST\",\n      body: formData,\n    });\n    if (!response.ok) throw new Error(\"Mất kết nối\");\n    const result = await response.json();\n    if (result.src) {\n      cachedImgs.push({ name: fileName, src: result.src });\n      console.log(\"up load thành công\");\n      return result.src;\n    }\n    throw new Error(`Lỗi: ${result}`);\n  } catch (e) {\n    console.error(e);\n    return { error: true };\n  }\n}\n\nfunction handleChange(e) {\n  const elem = e.target;\n  const i = parseInt(elem.dataset.index, 10);\n  if (elem?.type === \"radio\") {\n    select.clear();\n    select.add(i);\n  } else {\n    elem?.checked ? select.add(i) : select.delete(i);\n  }\n  handleBuild();\n}\n\nasync function handleSelect(auto) {\n  const data = await handleGet(\"auto\");\n  const autoData = new Set(data);\n  const groups = document.querySelectorAll(query.group);\n  const questionElem = document.querySelector(query.question);\n  const numberElem = document.querySelector(query.number);\n  const imgElem = document.querySelector(query.image);\n\n  select.clear();\n  [finalAnswer, groupAnswer, groupImgs] = [[], [], []];\n  question.img_src = \"\";\n\n  if (questionElem) {\n    question.text = standard(questionElem.innerText);\n  }\n  if (numberElem) {\n    question.no = parseInt(numberElem.innerText.replace(/\\D/g, \"\"));\n  }\n  if (imgElem) {\n    await new Promise((resolve) => {\n      const interval = setInterval(async () => {\n        if (!imgElem.src.includes(\"blob\")) return;\n        clearInterval(interval);\n        question.img_src = await handleUpload(imgElem.src);\n        resolve();\n      }, 10);\n    });\n  }\n\n  for (let i = 0; i < groups.length; i++) {\n    const input = groups[i].querySelector(\"input\");\n    const label = groups[i].querySelector(\"label\");\n    const image = groups[i].querySelector(\"img\");\n\n    if (input) {\n      input.dataset.index = i;\n      input.removeEventListener(\"click\", handleChange);\n      input.addEventListener(\"click\", handleChange);\n    }\n    if (label && label.innerText !== \"\") {\n      const ans = normal(label.innerText);\n      const key = normal(question.text + \" \" + ans).toLowerCase();\n      groupAnswer[i] = ans;\n      if (auto && autoData.has(key)) {\n        const interval = setInterval(() => {\n          if (groupAnswer.length < groups.length) return;\n          clearInterval(interval);\n          label.classList.add(\"selected-hehe\");\n          label.click();\n        }, 10);\n      }\n    } else if (image) {\n      const src = await handleUpload(image.src);\n      groupImgs[i] = { type: \"img\", src: src };\n    }\n  }\n\n  console.log(\"%c🟩 Tải câu hỏi\", style);\n}\n\nasync function handleBuild() {\n  for (let i = 0; i < groupAnswer.length; i++) {\n    const value = groupAnswer[i] ?? groupImgs[i];\n    if (value) {\n      finalAnswer[i] = (select.has(i) ? `*${label[i]}` : label[i]) + value;\n    }\n  }\n  test[question.no - 1] = {\n    ...question,\n    options: finalAnswer,\n    select: Array.from(select),\n  };\n  await handleSet(\"test\", test);\n}\n\nasync function handleSet(key, data) {\n  if (typeof chrome === \"undefined\" || !chrome.storage) {\n    console.error(\"Lỗi: không phải môi trường extension\");\n    return false;\n  }\n\n  try {\n    const result = await new Promise((resolve, reject) => {\n      chrome.storage.local.set({ [key]: data }, () => {\n        const error = chrome.runtime.lastError;\n        if (error) {\n          console.error(`Lỗi storage: ${error.message}`);\n          reject(error);\n        } else {\n          resolve(true);\n        }\n      });\n    });\n\n    console.log(`Lưu thành công với key: ${key}`);\n    return result;\n  } catch (e) {\n    console.error(`Lỗi khi thao tác storage - ${key}:`, e.message);\n    return false;\n  }\n}\n\nasync function handleGet(key) {\n  if (typeof chrome === \"undefined\" || !chrome.storage) {\n    console.error(\"Lỗi: không phải môi trường extension\");\n    return null;\n  }\n\n  try {\n    const result = await new Promise((resolve, reject) => {\n      chrome.storage.local.get([key], (result) => {\n        const error = chrome.runtime.lastError;\n        if (error) {\n          console.error(`Lỗi storage: ${error.message}`);\n          reject(error);\n        } else {\n          resolve(result[key] || null);\n        }\n      });\n    });\n\n    console.log(`Lấy thành công với key: ${key}`);\n    return result;\n  } catch (e) {\n    console.error(`Lỗi khi thao tác storage - ${key}:`, e.message);\n    return null;\n  }\n}\n\nasync function handleToggle() {\n  const setting = await handleGet(\"settings\");\n  const versionLabel = document.querySelector(\".app-version\");\n\n  if (!setting?.toggle) return;\n  if (versionLabel) {\n    versionLabel.addEventListener(\"click\", () => {\n      handleSelect(setting?.auto);\n    });\n  }\n  handleAddEvent(setting?.auto);\n}\n\nfunction handleAddEvent(auto) {\n  const handleClick = () => {\n    if (handleClick.debouncing) return;\n    handleClick.debouncing = true;\n    setTimeout(() => {\n      handleSelect(auto);\n      handleClick.debouncing = false;\n    }, 100);\n  };\n\n  setInterval(() => {\n    const btns = Array.from(document.querySelectorAll(query.btns));\n    const btn = btns.find(\n      (btn) => btn.label === query.label || btn.innerText.trim() === query.label\n    );\n\n    if (btn && !btn.dataset.event) {\n      btn.dataset.event = true;\n      console.log(\"%c🟩 Đã thấy nút\", style);\n      btn.addEventListener(\"click\", handleClick);\n      handleSelect(auto);\n    }\n  }, 1000);\n}\n\nfunction enableCopy() {\n  document.addEventListener(\"keydown\", (event) => {\n    if (event.ctrlKey && event.key === \"c\") {\n      const selection = window.getSelection().toString();\n      if (selection) {\n        navigator.clipboard.writeText(selection).catch((err) => {\n          console.error(\"Không thể sao chép:\", err);\n        });\n      }\n    }\n  });\n}\n\nconst href = window.location.href;\nif (href.includes(\"lms.ictu.edu.vn\") || href.startsWith(\"file\")) {\n  handleToggle();\n  enableCopy();\n  console.clear();\n  window.addEventListener(\n    \"contextmenu\",\n    function (e) {\n      e.stopPropagation();\n    },\n    true\n  );\n}\n"],"names":["query","style","finalAnswer","groupAnswer","groupImgs","test","question","select","cachedImgs","Set","label","normal","str","normalize","replace","trim","async","handleUpload","blobUrl","fileName","split","pop","existFile","find","img","name","src","responseBlob","fetch","ok","Error","blob","formData","FormData","append","response","method","body","result","json","push","console","log","e","error","handleChange","elem","target","i","parseInt","dataset","index","type","clear","add","checked","delete","length","_groupAnswer$i","value","has","no","options","Array","from","key","data","chrome","storage","Promise","resolve","reject","local","set","runtime","lastError","message","handleSet","handleBuild","handleSelect","auto","handleGet","autoData","groups","document","querySelectorAll","questionElem","querySelector","numberElem","imgElem","img_src","text","innerText","interval","setInterval","includes","clearInterval","input","image","removeEventListener","addEventListener","ans","toLowerCase","classList","click","get","href","window","location","startsWith","setting","versionLabel","toggle","handleClick","debouncing","setTimeout","btn","event","handleAddEvent","handleToggle","ctrlKey","selection","getSelection","toString","navigator","clipboard","writeText","catch","err","stopPropagation"],"sourceRoot":""}